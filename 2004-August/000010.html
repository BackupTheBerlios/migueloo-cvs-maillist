<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Migueloo-cvs] migueloo/modules/filemanager/view/classes miguel_vfilemanager.class.php,1.2,1.3
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/migueloo-cvs/2004-August/index.html" >
   <LINK REL="made" HREF="mailto:migueloo-cvs%40lists.berlios.de?Subject=Re%3A%20%5BMigueloo-cvs%5D%20migueloo/modules/filemanager/view/classes%20miguel_vfilemanager.class.php%2C1.2%2C1.3&In-Reply-To=%3C200408131804.i7DI4v611625%40bat.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000009.html">
   <LINK REL="Next"  HREF="000012.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Migueloo-cvs] migueloo/modules/filemanager/view/classes miguel_vfilemanager.class.php,1.2,1.3</H1>
    <B>antoniofcano</B> 
    <A HREF="mailto:migueloo-cvs%40lists.berlios.de?Subject=Re%3A%20%5BMigueloo-cvs%5D%20migueloo/modules/filemanager/view/classes%20miguel_vfilemanager.class.php%2C1.2%2C1.3&In-Reply-To=%3C200408131804.i7DI4v611625%40bat.berlios.de%3E"
       TITLE="[Migueloo-cvs] migueloo/modules/filemanager/view/classes miguel_vfilemanager.class.php,1.2,1.3">nobody at sheep.berlios.de
       </A><BR>
    <I>Fri Aug 13 20:04:57 CEST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="000009.html">[Migueloo-cvs] migueloo/modules/filemanager/control/classes miguel_cfilemanager.class.php,1.2,1.3
</A></li>
        <LI>Next message: <A HREF="000012.html">[Migueloo-cvs] migueloo/modules/andromeda/model/classes/ddbb base_ddbbdata.class.php,1.3,1.4
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10">[ date ]</a>
              <a href="thread.html#10">[ thread ]</a>
              <a href="subject.html#10">[ subject ]</a>
              <a href="author.html#10">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Update of /cvsroot/migueloo/migueloo/modules/filemanager/view/classes
In directory sheep:/tmp/cvs-serv21897/view/classes

Modified Files:
	miguel_vfilemanager.class.php 
Log Message:
Improved view restriction (visibility, lock, ...) tests


Index: miguel_vfilemanager.class.php
===================================================================
RCS file: /cvsroot/migueloo/migueloo/modules/filemanager/view/classes/miguel_vfilemanager.class.php,v
retrieving revision 1.2
retrieving revision 1.3
diff -C2 -d -r1.2 -r1.3
*** miguel_vfilemanager.class.php	12 Aug 2004 11:33:55 -0000	1.2
--- miguel_vfilemanager.class.php	13 Aug 2004 18:04:54 -0000	1.3
***************
*** 22,26 ****
        |   the world-wide-web at <A HREF="http://www.gnu.org/copyleft/gpl.html">http://www.gnu.org/copyleft/gpl.html</A>         |
        +----------------------------------------------------------------------+
!       | Authors: Antonio F. Cano Damas &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/migueloo-cvs">antoniofcano at telefonica.net</A>&gt;         |
        |          miguel Development Team                                     |
        |                       &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/migueloo-cvs">e-learning-desarrollo at listas.hispalinux.es</A>&gt;   |
--- 22,26 ----
        |   the world-wide-web at <A HREF="http://www.gnu.org/copyleft/gpl.html">http://www.gnu.org/copyleft/gpl.html</A>         |
        +----------------------------------------------------------------------+
!       | Authors: Antonio F. Cano Damas &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/migueloo-cvs">antonio at igestec.com</A>&gt;                 |
        |          miguel Development Team                                     |
        |                       &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/migueloo-cvs">e-learning-desarrollo at listas.hispalinux.es</A>&gt;   |
***************
*** 47,51 ****
   * Utiliza la libreria phphtmllib.
   *
!  * @author Antonio F. Cano Damas  &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/migueloo-cvs">antoniofcano at telefonica.net</A>&gt;
   * @author miguel development team &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/migueloo-cvs">e-learning-desarrollo at listas.hispalinux.es</A>&gt;
   * @package miguel base
--- 47,51 ----
   * Utiliza la libreria phphtmllib.
   *
!  * @author Antonio F. Cano Damas  &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/migueloo-cvs">antonio at igestec.com</A>&gt;
   * @author miguel development team &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/migueloo-cvs">e-learning-desarrollo at listas.hispalinux.es</A>&gt;
   * @package miguel base
***************
*** 81,84 ****
--- 81,85 ----
                                                                     $arr_data[$i]['folder_date'],
                                                                     $arr_data[$i]['folder_autor'],
+                                                                    $arr_data[$i]['folder_user_id'],
                                                                     0,
                                                                     $arr_data[$i]['folder_count_element'],
***************
*** 100,103 ****
--- 101,105 ----
                                                                     $arr_data[$i]['document_date'],
                                                                     $arr_data[$i]['document_autor'],
+                                                                    $arr_data[$i]['document_user_id'],
                                                                     0,
                                                                     $arr_data[$i]['document_size'],
***************
*** 175,180 ****
          }
  
!         function addDocumentInfo($_id, $_name, $_date, $_owner, $_downs, $_size, $_visible=1, $_lock=1, $_share=1, $_folder = false)
          {
                  $row = html_tr();
  
--- 177,193 ----
          }
  
!         function addDocumentInfo($_id, $_name, $_date, $_owner, $_owner_id, $_downs, $_size, $_visible=1, $_lock=1, $_share=1, $_folder = false)
          {
+                 $user_id = $this-&gt;getViewVariable('user_id');
+                 $profile_id = $this-&gt;getViewVariable('profile_id');
+                 //If not Admin, teacher or tutor
+                 if ( $profile_id &gt;= 4) {
+                     //Test ownership and visibility
+                     if ( ( $user_id != $_owner_id ) &amp;&amp; ($_visible == 0 ) ) {
+                         return ;
+                     }
+                 }
+ 
+                 //Necesito dos clases: una para visible y otra para invisible. La de invisible es para diferenciar en la vista del propietario o administrador
                  $row = html_tr();
  
***************
*** 213,216 ****
--- 226,267 ----
                  $elem8-&gt;set_tag_attribute('align', 'center');
  
+                 //---------------- TEST LOCK ---------------------------------------
+                 if ( ($_lock == 0) &amp;&amp; ($profile_id &gt;= 4) ){
+                     $elem9 = html_td('ptabla03', '', _HTML_SPACE);
+                     $elem9-&gt;set_tag_attribute('align', 'center');
+ 
+                     $elem10 = html_td('ptabla03', '', _HTML_SPACE);
+                     $elem10-&gt;set_tag_attribute('align', 'center');
+ 
+                     $elem11 = html_td('ptabla03', '', _HTML_SPACE);
+                     $elem11-&gt;set_tag_attribute('align', 'center');
+ 
+                     $elem12 = html_td('ptabla03', '', _HTML_SPACE);
+                     $elem12-&gt;set_tag_attribute('align', 'center');
+ 
+                     $elem13 = html_td('ptabla03', '', _HTML_SPACE);
+                     $elem13-&gt;set_tag_attribute('align', 'center');
+ 
+                     $elem14 = html_td('ptabla03', '', _HTML_SPACE);
+                     $elem14-&gt;set_tag_attribute('align', 'center');
+                   
+                     $row-&gt;add($elem1);
+                     $row-&gt;add($elem2);
+                     $row-&gt;add($elem3);
+                     $row-&gt;add($elem4);
+                     $row-&gt;add($elem5);
+                     $row-&gt;add($elem6);
+                     $row-&gt;add($elem7);
+                     $row-&gt;add($elem8);
+                     $row-&gt;add($elem9);
+                     $row-&gt;add($elem10);
+                     $row-&gt;add($elem11);
+                     $row-&gt;add($elem12);
+                     $row-&gt;add($elem13);
+                     $row-&gt;add($elem14);
+ 
+                     return $row;
+                 }
+ 
                  //----------------- COMMON OPERATIONS ------------------------------
                  $_fid = $this-&gt;getViewVariable('folder_id');
***************
*** 267,285 ****
  
                  if( !$_folder ) {
!                     if ($_lock == 0) {
!                         $status= 'lock';
!                         $icon='lock.png';
!                         $tooltip='Bloquear';
                      } else {
!                         $status='unlock';
!                         $icon='unlock.png';
!                         $tooltip='Desbloqear';
                      }
-                     $status = 'status='.$status.'&amp;id=';
-                     $img = $this-&gt;imag_alone(Util::format_URLPath('filemanager/index.php',$status.$_id),
-                                              Theme::getThemeImagePath('filemanager/'.$icon), agt($tooltip));
- 
                      $elem13 = html_td('ptabla03', '', $img);
                      $elem13-&gt;set_tag_attribute('align', 'center');
                      if ($_share == 0) {
                          $status= 'share';
--- 318,341 ----
  
                  if( !$_folder ) {
!                     //--------- ONLY TEACHER, TUTOR OR ADMIN CAN LOCK FILES ----------------
!                     if ($profile_id &lt; 4) {
!                         if ($_lock == 0) {
!                             $status= 'lock';
!                             $icon='lock.png';
!                             $tooltip='Bloquear';
!                         } else {
!                             $status='unlock';
!                             $icon='unlock.png';
!                             $tooltip='Desbloqear';
!                         }
!                         $status = 'status='.$status.'&amp;id=';
!                         $img = $this-&gt;imag_alone(Util::format_URLPath('filemanager/index.php',$status.$_id),
!                                                  Theme::getThemeImagePath('filemanager/'.$icon), agt($tooltip));
                      } else {
!                         $img = _HTML_SPACE;
                      }
                      $elem13 = html_td('ptabla03', '', $img);
                      $elem13-&gt;set_tag_attribute('align', 'center');
+ 
                      if ($_share == 0) {
                          $status= 'share';


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000009.html">[Migueloo-cvs] migueloo/modules/filemanager/control/classes miguel_cfilemanager.class.php,1.2,1.3
</A></li>
	<LI>Next message: <A HREF="000012.html">[Migueloo-cvs] migueloo/modules/andromeda/model/classes/ddbb base_ddbbdata.class.php,1.3,1.4
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10">[ date ]</a>
              <a href="thread.html#10">[ thread ]</a>
              <a href="subject.html#10">[ subject ]</a>
              <a href="author.html#10">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/migueloo-cvs">More information about the Migueloo-cvs
mailing list</a><br>
</body></html>
